/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 8 17:23
*/
KISSY.add("dd/constrain",function(f,j,i){function g(){g.superclass.constructor.apply(this,arguments)}function d(a){var d,h,a=a.drag.get("dragNode"),b=this.get("constrain");if(b){if(!0===b){var q=k(c);this.__constrainRegion={left:d=q.scrollLeft(),top:h=q.scrollTop(),right:d+q.width(),bottom:h+q.height()}}if(b.nodeType||f.isString(b))b=k(b);b.getDOMNode?(d=b.offset(),this.__constrainRegion={left:d.left,top:d.top,right:d.left+b.outerWidth(),bottom:d.top+b.outerHeight()}):f.isPlainObject(b)&&(this.__constrainRegion=
b);this.__constrainRegion&&(this.__constrainRegion.right-=a.outerWidth(),this.__constrainRegion.bottom-=a.outerHeight())}}function a(a){var a=a.info,c=a.left,h=a.top,b=this.__constrainRegion;b&&(a.left=Math.min(Math.max(b.left,c),b.right),a.top=Math.min(Math.max(b.top,h),b.bottom))}function e(){this.__constrainRegion=null}var k=i.all,c=f.Env.host;f.extend(g,j,{__constrainRegion:null,attachDrag:function(c){c.on("dragstart",d,this).on("dragend",e,this).on("dragalign",a,this)},detachDrag:function(c){c.detach("dragstart",
d,this).detach("dragend",e,this).detach("dragalign",a,this)}},{ATTRS:{constrain:{value:!0}}});return g},{requires:["base","node"]});KISSY.add("dd",function(f,j,i,g,d,a,e,k,c){return{Draggable:i,Droppable:g,DDM:j,Constrain:a,Proxy:d,DraggableDelegate:e,DroppableDelegate:k,Scroll:c}},{requires:"dd/ddm,dd/draggable,dd/droppable,dd/proxy,dd/constrain,dd/draggable-delegate,dd/droppable-delegate,dd/scroll".split(",")});
KISSY.add("dd/ddm",function(f,j,i,g,d,a){function e(){e.superclass.constructor.apply(this,arguments)}function k(a,c,h){var k=h.get("mode"),d=a.get("validDrops"),e=0,g=0,m=b(h.get("node")),i=v(m);f.each(d,function(a){var l;if(l=a.getNodeFromTarget(c,h.get("dragNode")[0],h.get("node")[0]))if("point"==k)q(b(l),h.mousePos)&&(l=v(b(l)),e?l<g&&(e=a,g=l):(e=a,g=l));else if("intersect"==k)l=v(x(m,b(l))),l>g&&(g=l,e=a);else if("strict"==k&&(l=v(x(m,b(l))),l==i))return e=a,!1});if((d=a.get("activeDrop"))&&
d!=e)d._handleOut(c),h._handleOut(c);a.__set("activeDrop",e);e&&(d!=e?e._handleEnter(c):e._handleOver(c))}function c(b){b._shim=(new d("<div style='background-color:red;position:"+(t?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+o.get("dragCursor")+";z-index:"+u+";'></div>")).prependTo(n.body||n.documentElement).css("opacity",0);c=m;if(t)g.on(y,"resize scroll",s,b);m(b)}function m(b){var a=b.get("activeDrag").get("activeHandler"),c="auto";a&&(c=a.css("cursor"));"auto"==c&&(c=
b.get("dragCursor"));b._shim.css({cursor:c,display:"block"});t&&s.call(b)}function p(b){var a=b.get("drops");b.__set("validDrops",[]);f.each(a,function(b){b._active()})}function h(b){var a=b.get("drops");b.__set("validDrops",[]);f.each(a,function(b){b._deActive()})}function b(b){var a=b.offset();return{left:a.left,right:a.left+b.outerWidth(),top:a.top,bottom:a.top+b.outerHeight()}}function q(b,a){return b.left<=a.left&&b.right>=a.left&&b.top<=a.top&&b.bottom>=a.top}function v(b){return b.top>=b.bottom||
b.left>=b.right?0:(b.right-b.left)*(b.bottom-b.top)}function x(b,a){var c=Math.max(b.top,a.top),h=Math.min(b.right,a.right),q=Math.min(b.bottom,a.bottom);return{left:Math.max(b.left,a.left),right:h,top:c,bottom:q}}var y=f.Env.host,n=y.document,t=6===j.ie,w=f.throttle(function(b){var a=this.__activeToDrag,c=this.get("activeDrag");(c||a)&&b.preventDefault();c?(c._move(b),k(this,b,c)):a&&a._move(b)},30),u=999999;e.ATTRS={prefixCls:{value:"ks-dd-"},dragCursor:{value:"move"},clickPixelThresh:{value:3},
bufferTime:{value:1E3},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var s=f.throttle(function(){var b;(b=this.get("activeDrag"))&&b.get("shim")&&this._shim.css({width:i.docWidth(),height:i.docHeight()})},30);f.extend(e,a,{__activeToDrag:0,_regDrop:function(b){this.get("drops").push(b)},_unRegDrop:function(b){b=f.indexOf(b,this.get("drops"));-1!=b&&this.get("drops").splice(b,1)},_regToDrag:function(b){this.__activeToDrag=b;g.on(n,"mouseup",this._end,this);g.on(n,"mousemove",
w,this);6===j.ie&&n.body.setCapture()},_start:function(){this.get("drops");var b=this.__activeToDrag;this.__set("activeDrag",b);this.__activeToDrag=0;b.get("shim")&&c(this);p(this)},_addValidDrop:function(b){this.get("validDrops").push(b)},_end:function(){var b=this.get("activeDrag"),a=this.get("activeDrop");g.remove(n,"mousemove",w,this);g.remove(n,"mouseup",this._end,this);6===j.ie&&n.body.releaseCapture();this.__activeToDrag&&(this.__activeToDrag._end(),this.__activeToDrag=0);this._shim&&this._shim.hide();
b&&(b._end(),h(this),a&&a._end(),this.__set("activeDrag",null),this.__set("activeDrop",null))}});var o=new e;o.inRegion=q;o.region=b;o.area=v;return o},{requires:["ua","dom","event","node","base"]});
KISSY.add("dd/draggable-delegate",function(f,j,i,g,d){function a(){a.superclass.constructor.apply(this,arguments)}function e(a){var c,e;if(this._checkMouseDown(a)){c=this.get("handlers");var f=new d(a.target);(c=c.length?this._getHandler(f):f)&&(e=this._getNode(c));e&&(this.__set("activeHandler",c),this.__set("node",e),this.__set("dragNode",e),this._prepare(a))}}f.extend(a,i,{_uiSetDisabledChange:function(a){this.get("container")[a?"addClass":"removeClass"](j.get("prefixCls")+"-disabled")},_init:function(){this.get("container").on("mousedown",
e,this).on("dragstart",this._fixDragStart)},_getHandler:function(a){for(var c=void 0,e=this.get("container"),d=this.get("handlers");a&&a[0]!==e[0];){f.each(d,function(h){if(g.test(a[0],h))return c=a,!1});if(c)break;a=a.parent()}return c},_getNode:function(a){return a.closest(this.get("selector"),this.get("container"))},destroy:function(){this.get("container").detach("mousedown",e,this).detach("dragstart",this._fixDragStart);this.detach()}},{ATTRS:{container:{setter:function(a){return d.one(a)}},selector:{},
handlers:{value:[],getter:0}}});return a},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/draggable",function(f,j,i,g,d){function a(){var b=this;a.superclass.constructor.apply(b,arguments);b.addTarget(d);f.each("dragalign,drag,dragdrophit,dragend,dragdropmiss,dragexit,dragenter,dragover,dragstart".split(","),function(a){b.publish(a,{bubbles:1})});b.__set("dragNode",b.get("node"));b.on("afterDisabledChange",b._uiSetDisabledChange,b);var c;(c=b.get("disabled"))&&b._uiSetDisabledChange(c);b._init()}function e(){return!1}function k(b){var a=b.target;this._checkMouseDown(b)&&
this._check(a)&&this._prepare(b)}var c=f.each,m=j.ie,p=f.Env.host.document;a.POINT="point";a.INTERSECT="intersect";a.STRICT="strict";a.ATTRS={node:{setter:function(b){return i.one(b)}},clickPixelThresh:{valueFn:function(){return d.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return d.get("bufferTime")}},dragNode:{},shim:{value:!0},handlers:{value:[],getter:function(b){var a=this;b.length||(b[0]=a.get("node"));c(b,function(c,h){f.isFunction(c)&&(c=c.call(a));if(f.isString(c)||c.nodeType)c=
i.one(c);b[h]=c});a.__set("handlers",b);return b}},activeHandler:{},dragging:{value:!1,setter:function(b){this.get("dragNode")[b?"addClass":"removeClass"](d.get("prefixCls")+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:{}}};var h;f.extend(a,g,{startMousePos:null,startNodePos:null,_diff:null,_bufferTimer:null,_uiSetDisabledChange:function(b){this.get("dragNode")[b?"addClass":"removeClass"](d.get("prefixCls")+"-disabled")},
_init:function(){this.get("node").on("mousedown",k,this).on("dragstart",this._fixDragStart)},_fixDragStart:function(b){b.preventDefault()},_check:function(b){var a=this,h=a.get("handlers"),e=0;c(h,function(c){if(c.contains(b)||c[0]==b)return e=1,a.__set("activeHandler",c),!1});return e},_checkMouseDown:function(b){return this.get("primaryButtonOnly")&&1<b.button||this.get("disabled")?0:1},_prepare:function(b){var a=this;m&&(h=p.body.onselectstart,p.body.onselectstart=e);a.get("halt")?b.halt():b.preventDefault();
var c=a.get("node"),f=b.pageX,b=b.pageY,c=c.offset();a.startMousePos=a.mousePos={left:f,top:b};a.startNodePos=c;a._diff={left:f-c.left,top:b-c.top};d._regToDrag(a);if(f=a.get("bufferTime"))a._bufferTimer=setTimeout(function(){a._start()},f)},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),this._bufferTimer=0)},_move:function(b){var a,c=this._diff;a=this.startMousePos;var h=b.pageX,b=b.pageY,e=h-c.left,c=b-c.top;this.get("dragging")?(this.mousePos={left:h,top:b},a=
{left:e,top:c,pageX:h,pageY:b,drag:this},this.fire("dragalign",{info:a}),h=1,!1===this.fire("drag",a)&&(h=0),h&&this.get("move")&&this.get("node").offset(a)):(c=this.get("clickPixelThresh"),(Math.abs(h-a.left)>=c||Math.abs(b-a.top)>=c)&&this._start())},stopDrag:function(){this.get("dragging")&&d._end()},_end:function(){var b;this._clearBufferTimer();m&&(p.body.onselectstart=h);this.get("dragging")&&(this.get("node").removeClass(d.get("prefixCls")+"drag-over"),(b=d.get("activeDrop"))?this.fire("dragdrophit",
{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.__set("dragging",0),this.fire("dragend",{drag:this}))},_handleOut:function(){this.get("node").removeClass(d.get("prefixCls")+"drag-over");this.fire("dragexit",{drag:this,drop:d.get("activeDrop")})},_handleEnter:function(b){this.get("node").addClass(d.get("prefixCls")+"drag-over");this.fire("dragenter",b)},_handleOver:function(b){this.fire("dragover",b)},_start:function(){this._clearBufferTimer();this.__set("dragging",1);d._start();this.fire("dragstart",
{drag:this})},destroy:function(){this.get("dragNode").detach("mousedown",k,this).detach("dragstart",this._fixDragStart);this.detach()}});return a},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(f,j,i,g,d){function a(){var a=this.get("container"),c=this.get("selector");this.__allNodes=a.all(c)}function e(){e.superclass.constructor.apply(this,arguments);j.on("dragstart",a,this)}f.extend(e,i,{getNodeFromTarget:function(a,c,e){var d={left:a.pageX,top:a.pageY},a=this.__allNodes,h=0,b=Number.MAX_VALUE;a&&a.each(function(a){var f=a[0];if(!(f===e||f===c)&&j.inRegion(j.region(a),d))f=j.area(j.region(a)),f<b&&(b=f,h=a)});h&&(this.__set("lastNode",this.get("node")),
this.__set("node",h));return h},_handleOut:function(){e.superclass._handleOut.apply(this,arguments);this.__set("node",0);this.__set("lastNode",0)},_handleOver:function(a){var c=this.get("node"),d=e.superclass._handleOut,f=e.superclass._handleOver,h=e.superclass._handleEnter,b=this.get("lastNode");b[0]!==c[0]?(this.__set("node",b),d.apply(this,arguments),this.__set("node",c),h.call(this,a)):f.call(this,a)},_end:function(){e.superclass._end.apply(this,arguments);this.__set("node",0)}},{ATTRS:{lastNode:{},
selector:{},container:{setter:function(a){return d.one(a)}}}});return e},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/droppable",function(f,j,i,g){function d(){var a=this;d.superclass.constructor.apply(a,arguments);a.addTarget(g);f.each(["dropexit","dropenter","dropover","drophit"],function(e){a.publish(e,{bubbles:1})});a._init()}d.ATTRS={node:{setter:function(a){if(a)return j.one(a)}},groups:{value:!0}};f.extend(d,i,{getNodeFromTarget:function(a,e,d){var a=this.get("node"),c=a[0];return c==e||c==d?null:a},_init:function(){g._regDrop(this)},_active:function(){var a=g.get("activeDrag"),e=this.get("node"),
d=this.get("groups"),c=a.get("groups"),a=g.get("prefixCls");a:if(!0===d)d=1;else{for(var f in d)if(c[f]){d=1;break a}d=0}d?(g._addValidDrop(this),e&&e.addClass(a+"drop-active-valid")):e&&e.addClass(a+"drop-active-invalid")},_deActive:function(){var a=this.get("node"),d=g.get("prefixCls");a&&a.removeClass(d+"drop-active-valid").removeClass(d+"drop-active-invalid")},__getCustomEvt:function(a){return f.mix({drag:g.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(g.get("prefixCls")+
"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);a.drag._handleEnter(a);this.get("node").addClass(g.get("prefixCls")+"drop-over");this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(g.get("prefixCls")+"drop-over");this.fire("drophit",a)},destroy:function(){g._unRegDrop(this)}});return d},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(f,j,i){function g(){g.superclass.constructor.apply(this,arguments);this[d]={}}var d="__proxy_destructors",a=f.stamp,e=f.guid("__dd_proxy"),k="__proxy";g.ATTRS={node:{value:function(a){return new j(a.get("node").clone(!0))}},destroyOnEnd:{value:!1},moveOnEnd:{value:!0}};f.extend(g,i,{attachDrag:function(c){function g(){var a=h.get("node"),b=c.get("node");h[k]?a=h[k]:f.isFunction(a)&&(a=a(c),a.addClass("ks-dd-proxy"),a.css("position","absolute"),h[k]=a);b.parent().append(a);
a.show();a.offset(b.offset());c.__set("dragNode",b);c.__set("node",a)}function i(){var a=h[k];h.get("moveOnEnd")&&c.get("dragNode").offset(a.offset());h.get("destroyOnEnd")?(a.remove(),h[k]=0):a.hide();c.__set("node",c.get("dragNode"))}var h=this,b=a(c,1,e);if(!b||!h[d][b])c.on("dragstart",g),c.on("dragend",i),b=a(c,0,e),h[d][b]={drag:c,fn:function(){c.detach("dragstart",g);c.detach("dragend",i)}}},detachDrag:function(c){var c=a(c,1,e),f=this[d];c&&f[c]&&(f[c].fn(),delete f[c])},destroy:function(){var a=
this.get("node"),e=this[d];a&&!f.isFunction(a)&&a.remove();for(var g in e)this.detachDrag(e[g].drag)}});i=g.prototype;i.attach=i.attachDrag;i.unAttach=i.detachDrag;return g},{requires:["node","base"]});
KISSY.add("dd/scroll",function(f,j,i,g,d){function a(){a.superclass.constructor.apply(this,arguments);this[m]={}}var e=f.Env.host,k=f.stamp,c=100,m="__dd_scrolls";a.ATTRS={node:{valueFn:function(){return g.one(e)},setter:function(a){return g.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var p=f.isWindow;f.extend(a,i,{getRegion:function(a){return p(a[0])?{width:d.viewportWidth(),height:d.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return p(a[0])?{left:d.scrollLeft(),
top:d.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,b){a.scrollLeft(b.left);a.scrollTop(b.top)},detachDrag:function(a){var b,c=this[m];if((b=k(a,1,"__dd-scroll-id-"))&&c[b])c[b].fn(),delete c[b]},destroy:function(){var a=this[m],b;for(b in a)this.detachDrag(a[b].drag)},attachDrag:function(a){function b(){if(p(n[0]))return 0;var b=a.mousePos,c=j.region(n);return!j.inRegion(c,b)?(clearTimeout(r),r=0,1):0}function d(c){!c.fake&&!b()&&
(o=c,l=f.clone(a.mousePos),c=i.getOffset(n),l.left-=c.left,l.top-=c.top,r||g())}function e(){clearTimeout(r);r=null}function g(){if(!b()){var d=i.getRegion(n),e=d.width,d=d.height,j=i.getScroll(n),k=f.clone(j),m=!1;l.top-d>=-s[1]&&(j.top+=u[1],m=!0);l.top<=s[1]&&(j.top-=u[1],m=!0);l.left-e>=-s[0]&&(j.left+=u[0],m=!0);l.left<=s[0]&&(j.left-=u[0],m=!0);m?(i.setScroll(n,j),r=setTimeout(g,c),o.fake=!0,p(n[0])&&(j=i.getScroll(n),o.left+=j.left-k.left,o.top+=j.top-k.top),a.get("move")&&a.get("node").offset(o),
a.fire("drag",o)):r=null}}var i=this,n=i.get("node"),t=k(a,0,"__dd-scroll-id-"),w=i[m];if(!w[t]){var u=i.get("rate"),s=i.get("diff"),o,l,r=null;a.on("drag",d);a.on("dragend",e);w[t]={drag:a,fn:function(){a.detach("drag",d);a.detach("dragend",e)}}}}});i=a.prototype;i.attach=i.attachDrag;i.unAttach=i.detachDrag;return a},{requires:["./ddm","base","node","dom"]});
