/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 2 10:12
*/
KISSY.add("ajax/FormSerializer",function(d,f){var g=/^(?:select|textarea)/i,i=/\r?\n/g,e=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return{serialize:function(h){var a=[],c={};d.each(f.query(h),function(b){b=b.elements?d.makeArray(b.elements):[b];a.push.apply(a,b)});a=d.filter(a,function(b){return b.name&&!b.disabled&&(b.checked||g.test(b.nodeName)||e.test(b.type))});d.each(a,function(b){var a=f.val(b),a=d.map(d.makeArray(a),function(b){return b.replace(i,
"\r\n")}),b=c[b.name]=c[b.name]||[];b.push.apply(b,a)});return d.param(c,void 0,void 0,!1)}}},{requires:["dom"]});
KISSY.add("ajax/IframeTransport",function(d,f,g,i){function e(a){this.xhrObject=a}var h=d.Env.host.document;i.setupConfig({converters:{iframe:i.getConfig().converters.text,text:{iframe:function(a){return a}}}});d.augment(e,{send:function(){var a=this.xhrObject,c=a.config,b,l=f.get(c.form);this.attrs={target:f.attr(l,"target")||"",action:f.attr(l,"action")||""};this.form=l;var e=d.guid("ajax-iframe");a.iframe=f.create("<iframe  id='"+e+"' name='"+e+"' style='position:absolute;left:-9999px;top:-9999px;'/>");
a.iframeId=e;f.prepend(a.iframe,h.body||h.documentElement);f.attr(l,{target:a.iframeId,action:c.url});if(c.data){b=c.data;c=c.serializeArray;b=d.unparam(b);var e=[],q;for(q in b)for(var i=d.isArray(b[q]),m=d.makeArray(b[q]),j=0;j<m.length;j++){var k=h.createElement("input");k.type="hidden";k.name=q+(i&&c?"[]":"");k.value=m[j];f.append(k,l);e.push(k)}b=e}this.fields=b;g.on(a.iframe,"load error",this._callback,this);l.submit()},_callback:function(a){var c=this.xhrObject,a=a.type,b=c.iframe;b&&(f.attr(this.form,
this.attrs),"load"==a?(a=b.contentWindow.document,c.responseXML=a,c.responseText=f.text(a.body),c._xhrReady(200,"success")):"error"==a&&c._xhrReady(500,"error"),f.remove(this.fields),g.detach(b),setTimeout(function(){f.remove(b)},30),c.iframe=null)},abort:function(){this._callback({},1)}});i.setupTransport("iframe",e);return i},{requires:["dom","event","./base"]});
KISSY.add("ajax/ScriptTransport",function(d,f){function g(e){if(!e.config.crossDomain)return new (f.getTransport("*"))(e);this.xhrObj=e;return 0}var i=d.Env.host,e=i.document;f.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(e){d.globalEval(e);return e}}}});d.augment(g,{send:function(){var d=this,a,c=this.xhrObj.config,b=e.head||e.getElementsByTagName("head")[0]||
e.documentElement;d.head=b;a=e.createElement("script");d.script=a;a.async="async";c.scriptCharset&&(a.charset=c.scriptCharset);a.src=c.url;a.onerror=a.onload=a.onreadystatechange=function(b){b=b||i.event;d._callback((b.type||"error").toLowerCase())};b.insertBefore(a,b.firstChild)},_callback:function(e,a){var c=this.script,b=this.xhrObj,l=this.head;if(c&&(a||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==e))c.onerror=c.onload=c.onreadystatechange=null,l&&c.parentNode&&l.removeChild(c),
this.head=this.script=void 0,!a&&"error"!=e?b._xhrReady(200,"success"):"error"==e&&b._xhrReady(500,"scripterror")},abort:function(){this._callback(0,1)}});f.setupTransport("script",g);return f},{requires:["./base","./XhrTransport"]});
KISSY.add("ajax/SubDomainTransport",function(d,f,g,i){function e(b){var c=b.config;this.xhrObj=b;b=c.url.match(a);this.hostname=b[2];this.protocol=b[1];c.crossDomain=!1}function h(){var c=b[this.hostname];c.ready=1;g.detach(c.iframe,"load",h,this);this.send()}var a=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,c=d.Env.host.document,b={};d.augment(e,f.proto,{send:function(){var a=this.xhrObj.config,e=this.hostname,d=b[e],o="/sub_domain_proxy.html";a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&
(o=a.xdr.subDomain.proxy);d&&d.ready?(this.nativeXhr=f.nativeXhr(0,d.iframe.contentWindow))&&this.sendInternal():(d?a=d.iframe:(d=b[e]={},a=d.iframe=c.createElement("iframe"),i.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),i.prepend(a,c.body||c.documentElement),a.src=this.protocol+"//"+e+o),g.on(a,"load",h,this))}});return e},{requires:["./XhrTransportBase","event","dom"]});
KISSY.add("ajax/XdrFlashTransport",function(d,f,g){function i(c,e,d){l||(l=!0,c='<object id="'+a+'" type="application/x-shockwave-flash" data="'+c+'" width="0" height="0"><param name="movie" value="'+c+'" /><param name="FlashVars" value="yid='+e+"&uid="+d+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',e=b.createElement("div"),g.prepend(e,b.body||b.documentElement),e.innerHTML=c)}function e(b){this.xhrObj=b}var h={},a="io_swf",c,b=d.Env.host.document,
l=!1;d.augment(e,{send:function(){var b=this,a=b.xhrObj.config;i((a.xdr||{}).src||d.Config.base+"ajax/io.swf",1,1);c?(b._uid=d.guid(),h[b._uid]=b,c.send(a.url,{id:b._uid,uid:b._uid,method:a.type,data:a.hasContent&&a.data||{}})):setTimeout(function(){b.send()},200)},abort:function(){c.abort(this._uid)},_xdrResponse:function(b,a){var c,e=this.xhrObj;e.responseText=decodeURI(a.c.responseText);switch(b){case "success":c={status:200,statusText:"success"};delete h[a.id];break;case "abort":delete h[a.id];
break;case "timeout":case "transport error":case "failure":delete h[a.id],c={status:500,statusText:b}}c&&e._xhrReady(c.status,c.statusText)}});f.applyTo=function(b,a,c){var b=a.split(".").slice(1),e=f;d.each(b,function(b){e=e[b]});e.apply(null,c)};f.xdrReady=function(){c=b.getElementById(a)};f.xdrResponse=function(b,a,c){var e=h[a.uid];e&&e._xdrResponse(b,a,c)};return e},{requires:["./base","dom"]});
KISSY.add("ajax/XhrObject",function(d,f){function g(a){var c=a.responseText,b=a.responseXML,e=a.config,h=e.converters,i=a.converters||{},g,m,j=e.contents,k=e.dataType;if(c||b){for(e=a.mimeType||a.getResponseHeader("Content-Type");"*"==k[0];)k.shift();if(!k.length)for(g in j)if(j[g].test(e)){k[0]!=g&&k.unshift(g);break}k[0]=k[0]||"text";"text"==k[0]&&c!==f?m=c:"xml"==k[0]&&b!==f?m=b:d.each(["text","xml"],function(a){var e=k[0];if(i[a]&&i[a][e]||h[a]&&h[a][e])return k.unshift(a),m="text"==a?c:b,!1})}j=
k[0];for(e=1;e<k.length;e++){g=k[e];var n=i[j]&&i[j][g]||h[j]&&h[j][g];if(!n)throw"no covert for "+j+" => "+g;m=n(m);j=g}a.responseData=m}function i(a){e.call(this);d.mix(this,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new d.Defer(this)})}var e=d.Promise,h=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;d.extend(i,e,{setRequestHeader:function(a,
c){this.requestHeaders[a]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(a){var c;if(2===this.state){if(!this.responseHeaders)for(this.responseHeaders={};c=h.exec(this.responseHeadersString);)this.responseHeaders[c[1]]=c[2];c=this.responseHeaders[a]}return c===f?null:c},overrideMimeType:function(a){this.state||(this.mimeType=a);return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this._xhrReady(0,
a);return this},getNativeXhr:function(){var a;if(a=this.transport)return a.nativeXhr},_xhrReady:function(a,c){if(2!=this.state){this.state=2;this.readyState=4;var b;if(200<=a&&300>a||304==a)if(304==a)c="notmodified",b=!0;else try{g(this),c="success",b=!0}catch(e){c="parsererror : "+e}else 0>a&&(a=0);this.status=a;this.statusText=c;this._defer[b?"resolve":"reject"]([this.responseData,this.statusText,this])}}});return i});
KISSY.add("ajax/XhrTransport",function(d,f,g,i,e,h){var a=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,c=d.Env.host.XDomainRequest,b=g.nativeXhr();if(b){var l=function(b){b=b.split(".");return 2>b.length?b.join("."):b.reverse().slice(0,2).reverse().join(".")},p=function(d){var f=d.config,p=f.xdr||{};if(f.crossDomain){var j=f.url.match(a);if(l(location.hostname)==l(j[2]))return new i(d);if(!("withCredentials"in b)&&("flash"===""+p.use||!c))return new e(d)}this.xhrObj=d;this.nativeXhr=g.nativeXhr(f.crossDomain);
return h};d.augment(p,g.proto,{send:function(){this.sendInternal()}});f.setupTransport("*",p)}return f},{requires:["./base","./XhrTransportBase","./SubDomainTransport","./XdrFlashTransport"]});
KISSY.add("ajax/XhrTransportBase",function(d,f){function g(a,c){try{return new (c||i).XMLHttpRequest}catch(b){}}var i=d.Env.host,e=i.XDomainRequest,h={proto:{}};h.nativeXhr=i.ActiveXObject?function(a,c){var b;if(a&&e)b=new e;else if(!(b=!f.isLocal&&g(a,c)))a:{try{b=new (c||i).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}b=void 0}return b}:g;d.mix(h.proto,{sendInternal:function(){var a=this,c=a.xhrObj,b=c.config,d=a.nativeXhr,f,h;b.username?d.open(b.type,b.url,b.async,b.username,b.password):
d.open(b.type,b.url,b.async);if(f=b.xhrFields)for(h in f)f.hasOwnProperty(h)&&(d[h]=f[h]);c.mimeType&&d.overrideMimeType&&d.overrideMimeType(c.mimeType);!b.crossDomain&&!c.requestHeaders["X-Requested-With"]&&(c.requestHeaders["X-Requested-With"]="XMLHttpRequest");try{if(!b.crossDomain)for(h in c.requestHeaders)d.setRequestHeader(h,c.requestHeaders[h])}catch(g){}d.send(b.hasContent&&b.data||null);!b.async||4==d.readyState?a._callback():e&&d instanceof e?(d.onload=function(){d.readyState=4;d.status=
200;a._callback()},d.onerror=function(){d.readyState=4;d.status=500;a._callback()}):d.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,c){try{var b=this.nativeXhr,h=this.xhrObj,g=h.config;if(c||4==b.readyState)if(e&&b instanceof e?(b.onerror=d.noop,b.onload=d.noop):b.onreadystatechange=d.noop,c)4!==b.readyState&&b.abort();else{var i=b.status;e&&b instanceof e||(h.responseHeadersString=b.getAllResponseHeaders());var o=b.responseXML;o&&o.documentElement&&
(h.responseXML=o);h.responseText=b.responseText;try{var m=b.statusText}catch(j){m=""}!i&&f.isLocal&&!g.crossDomain?i=h.responseText?200:404:1223===i&&(i=204);h._xhrReady(i,m)}}catch(k){b.onreadystatechange=d.noop,c||h._xhrReady(-1,k)}}});return h},{requires:["./base"]});
KISSY.add("ajax",function(d,f,g,i){function e(a,c,b,e,f){d.isFunction(c)&&(e=b,b=c,c=h);return g({type:f||"get",url:a,data:c,success:b,dataType:e})}var h=void 0;d.mix(g,{XhrObject:i,serialize:f.serialize,get:e,post:function(a,c,b,f){d.isFunction(c)&&(f=b,b=c,c=h);return e(a,c,b,f,"post")},jsonp:function(a,c,b){d.isFunction(c)&&(b=c,c=h);return e(a,c,b,"jsonp")},getScript:d.getScript,getJSON:function(a,c,b){d.isFunction(c)&&(b=c,c=h);return e(a,c,b,"json")},upload:function(a,c,b,e,f){d.isFunction(b)&&
(f=e,e=b,b=h);return g({url:a,type:"post",dataType:f,form:c,data:b,success:e})}});d.mix(d,{Ajax:g,IO:g,ajax:g,io:g,jsonp:g.jsonp});return g},{requires:"ajax/FormSerializer,ajax/base,ajax/XhrObject,ajax/XhrTransport,ajax/ScriptTransport,ajax/jsonp,ajax/form,ajax/IframeTransport".split(",")});
KISSY.add("ajax/base",function(d,f,g,i,e){function h(a){var c=a.context;delete a.context;a=d.mix(d.clone(r),a||{},e,e,!0);a.context=c;"crossDomain"in a||(c=l.exec(a.url.toLowerCase()),a.crossDomain=!(!c||!(c[1]!=n[1]||c[2]!=n[2]||(c[3]||("http:"===c[1]?q:o))!=(n[3]||("http:"===n[1]?q:o)))));a.processData&&a.data&&!d.isString(a.data)&&(a.data=d.param(a.data,e,e,a.serializeArray));a.url=a.url.replace(/^\/\//,n[1]+"//");a.type=a.type.toUpperCase();a.hasContent=!m.test(a.type);a.dataType=d.trim(a.dataType||
"*").split(b);!("cache"in a)&&d.inArray(a.dataType[0],["script","jsonp"])&&(a.cache=!1);if(!a.hasContent&&(a.data&&(a.url+=(/\?/.test(a.url)?"&":"?")+a.data,delete a.data),!1===a.cache))a.url+=(/\?/.test(a.url)?"&":"?")+"_ksTS="+(d.now()+"_"+d.guid());a.context=a.context||a;return a}function a(a,b){c.fire(a,{ajaxConfig:b.config,xhr:b})}function c(b){function c(e){return function(c){d.timeoutTimer&&(clearTimeout(d.timeoutTimer),d.timeoutTimer=0);var f=b[e];f&&f.apply(b.context,c);a(e,d)}}if(!b.url)return e;
var b=h(b),d=new i(b);a("start",d);var f=new (s[b.dataType[0]]||s["*"])(d);d.transport=f;b.contentType&&d.setRequestHeader("Content-Type",b.contentType);var g=b.dataType[0],j=b.accepts;d.setRequestHeader("Accept",g&&j[g]?j[g]+("*"===g?"":", */*; q=0.01"):j["*"]);for(var k in b.headers)d.setRequestHeader(k,b.headers[k]);if(b.beforeSend&&!1===b.beforeSend.call(b.context||b,d,b))return e;d.then(c("success"),c("error"));d.fin(c("complete"));d.readyState=1;a("send",d);b.async&&0<b.timeout&&(d.timeoutTimer=
setTimeout(function(){d.abort("timeout")},1E3*b.timeout));try{d.state=1,f.send()}catch(l){2>d.state&&d._xhrReady(-1,l)}return d}var b=/\s+/,l=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,p=function(a){return a},q=80,o=443,m=/^(?:GET|HEAD)$/,j,k=d.Env.host.document,n;try{j=location.href}catch(t){j=k.createElement("a"),j.href="",j=j.href}n=l.exec(j)||["","","",""];j=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(n[1]);var s={},r={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",
async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:f.parse,html:p,text:p,xml:d.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};r.converters.html=r.converters.text;d.mix(c,g.Target);d.mix(c,{isLocal:j,setupConfig:function(a){d.mix(r,a,e,e,!0)},setupTransport:function(a,b){s[a]=b},getTransport:function(a){return s[a]},getConfig:function(){return r}});
return c},{requires:["json","event","./XhrObject"]});KISSY.add("ajax/form",function(d,f,g,i){f.on("start",function(e){e=e.xhr.config;if(e.form){var d=g.get(e.form);if("multipart/form-data"!=(d.encoding||d.enctype).toLowerCase()){if(d=i.serialize(d))e.hasContent?(e.data=e.data||"",e.data&&(e.data+="&"),e.data+=d):e.url+=(/\?/.test(e.url)?"&":"?")+d}else d=e.dataType[0],"*"==d&&(d="text"),e.dataType.length=2,e.dataType[0]="iframe",e.dataType[1]=d}});return f},{requires:["./base","dom","./FormSerializer"]});
KISSY.add("ajax/jsonp",function(d,f){var g=d.Env.host;f.setupConfig({jsonp:"callback",jsonpCallback:function(){return d.guid("jsonp")}});f.on("start",function(f){var f=f.xhr,e=f.config;if("jsonp"==e.dataType[0]){var h,a=e.jsonpCallback,c=d.isFunction(a)?a():a,b=g[c];e.url+=(/\?/.test(e.url)?"&":"?")+e.jsonp+"="+c;g[c]=function(a){1<arguments.length&&(a=d.makeArray(arguments));h=[a]};f.fin(function(){g[c]=b;if(void 0===b)try{delete g[c]}catch(a){}else h&&b(h[0])});f.converters=f.converters||{};f.converters.script=
f.converters.script||{};f.converters.script.json=function(){return h[0]};e.dataType.length=2;e.dataType[0]="script";e.dataType[1]="json"}});return f},{requires:["./base"]});
