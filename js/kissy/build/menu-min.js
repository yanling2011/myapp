/*
Copyright 2012, KISSY UI Library v1.30dev
MIT Licensed
build time: May 2 17:36
*/
KISSY.add("menu/base",function(g,d,f,h,c){function b(){this.set("highlightedItem",void 0)}var a=d.KeyCodes,e=f.create(h.Container,{_uiSetHighlightedItem:function(a,i){var b=i&&i.prevVal;b&&b.set("highlighted",!1);a&&a.set("highlighted",!0);this.set("activeItem",a)},handleBlur:function(a){e.superclass.handleBlur.call(this,a);this.set("highlightedItem",void 0)},_getNextEnabledHighlighted:function(a,i){var b=this.get("children"),c=b.length,j=a;do{var n=b[a];if(!n.get("disabled")&&!1!==n.get("visible"))return b[a];
a=(a+i+c)%c}while(a!=j)},handleKeydown:function(a){if(this.handleKeyEventInternal(a))return a.halt(),!0},handleKeyEventInternal:function(b){var i=this.get("highlightedItem");if(i&&i.handleKeydown(b))return!0;var c=this.get("children"),e=c.length;if(0!==e){switch(b.keyCode){case a.ESC:return;case a.HOME:this.set("highlightedItem",this._getNextEnabledHighlighted(0,1));break;case a.END:this.set("highlightedItem",this._getNextEnabledHighlighted(e-1,-1));break;case a.UP:i?(b=g.indexOf(i,c),e=(b-1+e)%e):
e-=1;this.set("highlightedItem",this._getNextEnabledHighlighted(e,-1));break;case a.DOWN:i?(b=g.indexOf(i,c),e=(b+1+e)%e):e=0;this.set("highlightedItem",this._getNextEnabledHighlighted(e,1));break;default:return}return!0}},bindUI:function(){this.on("hide",b,this)},containsElement:function(a){if(!1===this.get("visible")||!this.get("view"))return!1;if(this.get("view").containsElement(a))return!0;for(var b=this.get("children"),e=0,c=b.length;e<c;e++){var j=b[e];if("function"==typeof j.containsElement&&
j.containsElement(a))return!0}return!1}},{ATTRS:{visibleMode:{value:"display"},highlightedItem:{},activeItem:{view:!0}},DefaultRender:c},"Menu");h.UIStore.setUIConstructorByCssClass("menu",{priority:h.UIStore.PRIORITY.LEVEL1,ui:e});return e},{requires:["event","uibase","component","./menurender","./submenu"]});
KISSY.add("menu/filtermenu",function(g,d,f,h,c){var b=d.create(h,{bindUI:function(){this.get("view").get("filterInput").on("keyup",this.handleFilterEvent,this)},handleMouseEnter:function(){b.superclass.handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a=this.get("view").get("filterInput"),b=this.get("highlightedItem");this.set("filterStr",a.val());(!b||!b.get("visible"))&&this.set("highlightedItem",this._getNextEnabledHighlighted(0,1))},
_uiSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var b=this.get("view"),c=b.get("labelEl"),b=b.get("filterInput");c[a?"hide":"show"]();if(this.get("allowMultiple")){var c=[],i;i=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var d=[];i&&(d=i[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(c=[],i&&(c=d,i=d[d.length-1],(d=(d=this.get("highlightedItem"))&&d.get("html"))&&-1<d.indexOf(i)&&i&&(c[c.length-1]=d),b.val(c.join(",")+",")),a=""):(i&&(a=i[2]||""),c=d);this.get("enteredItems").length!=
c.length&&this.set("enteredItems",c)}var b=this.get("children"),f=a&&RegExp(a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"ig"),j=this.getCssClassWithPrefix("menuitem-hit");g.each(b,function(b){var c=b.get("html");a?-1<c.indexOf(a)?(b.set("visible",!0),b.get("el").html(c.replace(f,function(a){return"<span class='"+j+"'>"+a+"</span>"}))):b.set("visible",!1):(b.get("el").html(c),b.set("visible",!0))})},decorateInternal:function(a){this.set("el",a);this.decorateChildren(a.one("."+
this.getCssClassWithPrefix("menu-content")))},reset:function(){var a=this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(a=a&&a.get("filterInput"))&&a.val("")},destructor:function(){var a=this.get("view");(a=a&&a.get("filterInput"))&&a.detach()}},{ATTRS:{label:{view:!0},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1}},DefaultRender:c},"Menu_FilterMenu");f.UIStore.setUIConstructorByCssClass("filtermenu",{priority:f.UIStore.PRIORITY.LEVEL2,ui:b});return b},{requires:["uibase",
"component","./base","./filtermenurender"]});
KISSY.add("menu/filtermenurender",function(g,d,f,h){var c=d.all;return f.create(h,{getContentElement:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},createDom:function(){var b=h.prototype.getContentElement.call(this),a=this.get("filterWrap");a||this.set("filterWrap",a=c("<div class='"+this.getCssClassWithPrefix("menu-filter")+"'/>").appendTo(b));this.get("labelEl")||this.set("labelEl",c("<div class='"+this.getCssClassWithPrefix("menu-filter-label")+
"'/>").appendTo(a));this.get("filterInput")||this.set("filterInput",c("<input autocomplete='off'/>").appendTo(a));this.get("menuContent")||this.set("menuContent",c("<div class='"+this.getCssClassWithPrefix("menu-content")+"'/>").appendTo(b))},_uiSetLabel:function(b){this.get("labelEl").html(b)}},{ATTRS:{label:{}},HTML_PARSER:{labelEl:function(b){return b.one("."+this.getCssClassWithPrefix("menu-filter")).one("."+this.getCssClassWithPrefix("menu-filter-label"))},filterWrap:function(b){return b.one("."+
this.getCssClassWithPrefix("menu-filter"))},menuContent:function(b){return b.one("."+this.getCssClassWithPrefix("menu-content"))},filterInput:function(b){return b.one("."+this.getCssClassWithPrefix("menu-filter")).one("input")}}},"Menu_FilterMenu_Render")},{requires:["node","uibase","./menurender"]});KISSY.add("menu",function(g,d,f,h,c,b,a,e,k,i,m,l){d.Render=f;d.Item=h;h.Render=c;d.SubMenu=b;b.Render=a;d.Separator=e;d.PopupMenu=i;i.Render=m;d.FilterMenu=l;return d},{requires:"menu/base,menu/menurender,menu/menuitem,menu/menuitemrender,menu/submenu,menu/submenurender,menu/separator,menu/separatorrender,menu/popupmenu,menu/popupmenurender,menu/filtermenu".split(",")});
KISSY.add("menu/menuitem",function(g,d,f,h){var c=g.all,b=d.create(f.Controller,{handleMouseEnter:function(a){if(b.superclass.handleMouseEnter.call(this,a))return!0;this.get("parent").set("highlightedItem",this)},handleMouseLeave:function(a){if(b.superclass.handleMouseLeave.call(this,a))return!0;this.get("parent").set("highlightedItem",null)},performActionInternal:function(){this.get("selectable")&&this.set("selected",!0);this.get("checkable")&&this.set("checked",!this.get("checked"));this.get("parent").fire("click",
{target:this});return!0},_uiSetHighlighted:function(a){if(a){var a=this.get("el"),b=a.parent(function(a){return"visible"!=c(a).css("overflow")},this.get("parent").get("el").parent());b&&a.scrollIntoView(b,void 0,void 0,!0)}},containsElement:function(a){return this.get("view")&&this.get("view").containsElement(a)}},{ATTRS:{focusable:{value:!1},visibleMode:{value:"display"},handleMouseEvents:{value:!1},selectable:{view:!0},checkable:{view:!0},value:{},checked:{view:!0},selected:{view:!0},content:{getter:function(){return this.get("html")},
setter:function(a){return this.set("html",a)}}},HTML_PARSER:{selectable:function(a){var b=this.getCssClassWithPrefix("menuitem-selectable");return a.hasClass(b)}}},"Menu_Item");b.DefaultRender=h;f.UIStore.setUIConstructorByCssClass("menuitem",{priority:f.UIStore.PRIORITY.LEVEL1,ui:b});return b},{requires:["uibase","component","./menuitemrender"]});
KISSY.add("menu/menuitemrender",function(g,d,f,h){return f.create(h.Render,{_uiSetChecked:function(c){var b=this.get("el"),a=this.getComponentCssClassWithState("-checked");b[c?"addClass":"removeClass"](a)},_uiSetSelected:function(c){var b=this.get("el"),a=this.getComponentCssClassWithState("-selected");b[c?"addClass":"removeClass"](a)},_uiSetSelectable:function(c){this.get("el").attr("role",c?"menuitemradio":"menuitem")},_uiSetCheckable:function(c){if(c){var b=this.get("el"),a=this.getCssClassWithPrefix("menuitem-checkbox"),
e=b.one("."+a);e||(e=(new d("<div class='"+a+"'/>")).prependTo(b),e.unselectable())}this.get("el").attr("role",c?"menuitemcheckbox":"menuitem")},containsElement:function(c){var b=this.get("el");return b[0]==c||b.contains(c)}},{ATTRS:{elAttrs:{valueFn:function(){return{role:"menuitem",id:g.guid("ks-menuitem")}}},selected:{},checked:{}}},"Menu_Item_Render")},{requires:["node","uibase","component"]});
KISSY.add("menu/menurender",function(g,d,f,h){return f.create(h.Render,{renderUI:function(){var c=this.get("el");c.attr("role","menu").attr("aria-haspopup",!0);c.attr("id")||c.attr("id",g.guid("ks-menu"))},_uiSetActiveItem:function(c){var b=this.get("el");c?(c=c.get("el").attr("id"),b.attr("aria-activedescendant",c)):b.attr("aria-activedescendant","")},containsElement:function(c){var b=this.get("el");return b[0]===c||b.contains(c)}},{ATTRS:{activeItem:{}}},"Menu_Render")},{requires:["ua","uibase",
"component"]});
KISSY.add("menu/popupmenu",function(g,d,f,h,c){function b(a){var b=a.get("parent"),c;b&&b.get("menu")==a&&(c=b.get("parent"));return c}function a(a){return(a=b(a))&&a.get(e)?a:0}var e="autoHideOnMouseLeave",k=d.create(h,[d.ContentBox,d.Position,d.Align],{_clearLeaveHideTimers:function(){var a,b,c;if(this.get(e)){if(a=this._leaveHideTimer)clearTimeout(a),this._leaveHideTimer=0;var j=this.get("children");for(a=0;a<j.length;a++)b=j[a],(c=b.get("menu"))&&!g.isFunction(c)&&c.get(e)&&c._clearLeaveHideTimers()}},handleMouseLeave:function(){var c=
this,d;c.get(e)&&(c._leaveHideTimer=setTimeout(function(){c.hide();var a=c.get("parent"),j;a&&(j=b(c))&&j.get("highlightedItem")===a&&j.set("highlightedItem",null)},c.get("autoHideDelay")),(d=a(c))&&d.handleMouseLeave())},handleMouseEnter:function(){if(this.get(e)){var b=a(this);b&&b.handleMouseEnter();this._clearLeaveHideTimers()}},handleBlur:function(){k.superclass.handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:!1},visibleMode:{value:"visibility"},autoHideOnMouseLeave:{},
autoHideDelay:{value:0.1}},DefaultRender:c},"Menu_PopupMenu");f.UIStore.setUIConstructorByCssClass("popupmenu",{priority:f.UIStore.PRIORITY.LEVEL2,ui:k});return k},{requires:["uibase","component","./base","./popupmenurender"]});KISSY.add("menu/popupmenurender",function(g,d,f,h){return f.create(h,[f.ContentBox.Render,f.Position.Render,6===d.ie?f.Shim.Render:null],"Menu_PopupMenu_Render")},{requires:["ua","uibase","./menurender"]});
KISSY.add("menu/separator",function(g,d,f,h){g=d.create(f.Controller,{},{ATTRS:{focusable:{value:!1},disabled:{value:!0},handleMouseEvents:{value:!1}},DefaultRender:h},"Menu_Separator");f.UIStore.setUIConstructorByCssClass("menuseparator",{priority:f.UIStore.PRIORITY.LEVEL2,ui:g});return g},{requires:["uibase","component","./separatorrender"]});
KISSY.add("menu/separatorrender",function(g,d,f){return d.create(f.Render,{createDom:function(){this.get("el").attr("role","separator")}},"Menu_Separator_Render")},{requires:["uibase","component"]});
KISSY.add("menu/submenu",function(g,d,f,h,c,b){function a(a,b){var c=a.get("parent");c&&(c.on("hide",a._onParentHide,a),b.on("click",function(a){c.fire("click",{target:a.target})}),c.__bindDocClickToHide||(d.on(m,"click",k,a),c.__bindDocClickToHide=1,b.__bindDocClickToHide=1),b.on("afterActiveItemChange",function(a){c.set("activeItem",a.newVal)}));b.on("beforeHighlightedItemChange",a.onChildHighlight_,a)}function e(b,c){var d=b.get("menu");if(g.isFunction(d))if(c)d=d.call(b),b.__set("menu",d);else return null;
d&&d.get("parent")!==b&&(d.__set("parent",b),a(b,d));return d}function k(a){var b=e(this),a=a.target,c=this.get("parent");this.get("el");c.containsElement(a)||(b&&b.hide(),this.get("parent").set("highlightedItem",null))}var i=d.KeyCodes,m=g.Env.host.document,l=f.create(c,[h.DecorateChild],{_onParentHide:function(){var a=e(this);a&&a.hide()},handleMouseEnter:function(a){if(l.superclass.handleMouseEnter.call(this,a))return!0;this.clearTimers();this.showTimer_=g.later(this.showMenu,this.get("menuDelay"),
!1,this)},showMenu:function(){var a=e(this,1);a&&(a.set("align",g.mix({node:this.get("el"),points:["tr","tl"]},this.get("menuAlign"))),a.render(),this.get("el").attr("aria-haspopup",a.get("el").attr("id")),a.show())},clearTimers:function(){this.dismissTimer_&&(this.dismissTimer_.cancel(),this.dismissTimer_=null);this.showTimer_&&(this.showTimer_.cancel(),this.showTimer_=null);var a=e(this);a&&a._leaveHideTimer&&(clearTimeout(a._leaveHideTimer),a._leaveHideTimer=0)},onChildHighlight_:function(a){a.newVal&&
(this.clearTimers(),this.get("parent").set("highlightedItem",this))},hideMenu:function(){var a=e(this);a&&a.hide()},performActionInternal:function(){this.clearTimers();this.showMenu();l.superclass.performActionInternal.apply(this,arguments)},handleKeydown:function(a){var b=e(this),c=b&&b.get("visible"),f=a.keyCode;if(c){if(!b.handleKeydown(a))if(f==i.LEFT)this.hideMenu(),this.get("parent").set("activeItem",this);else return}else if(f==i.RIGHT){if(this.showMenu(),b=e(this))a=b.get("children"),a[0]&&
b.set("highlightedItem",a[0])}else{if(a.keyCode==d.KeyCodes.ENTER)return this.performActionInternal(a);return}return!0},_uiSetHighlighted:function(a,b){l.superclass._uiSetHighlighted.call(this,a,b);a||(this.clearTimers(),this.dismissTimer_=g.later(this.hideMenu,this.get("menuDelay"),!1,this))},containsElement:function(a){var b=e(this);return b&&b.containsElement(a)},decorateChildrenInternal:function(a,b){b.css("visibility","hidden");g.one(b[0].ownerDocument.body).prepend(b);this.__set("menu",new a({srcNode:b,
prefixCls:this.get("prefixCls")}))},destructor:function(){var a=this.get("parent"),b=e(this);this.clearTimers();b&&b.__bindDocClickToHide&&(b.__bindDocClickToHide=0,d.remove(m,"click",k,this));a&&a.detach("hide",this._onParentHide,this);b&&!this.get("externalSubMenu")&&b.destroy()}},{ATTRS:{menuDelay:{value:300},externalSubMenu:{value:!1},menuAlign:{},menu:{},decorateChildCls:{value:"popupmenu"}},DefaultRender:b},"Menu_SubMenu");h.UIStore.setUIConstructorByCssClass("submenu",{priority:h.UIStore.PRIORITY.LEVEL2,
ui:l});return l},{requires:["event","uibase","component","./menuitem","./submenurender"]});
KISSY.add("menu/submenurender",function(g,d,f){var h;return h=d.create(f,{renderUI:function(){this.get("el").attr("aria-haspopup","true").append(g.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))},_uiSetHtml:function(c){h.superclass._uiSetHtml.call(this,c);this.get("el").append(g.substitute('<span class="{prefixCls}submenu-arrow">\u25ba</span>',{prefixCls:this.get("prefixCls")}))}},"Menu_SubMenu_Render")},{requires:["uibase","./menuitemrender"]});
